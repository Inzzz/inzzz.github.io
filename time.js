var Wk = ["Понедельник | 1 неделя","Вторник | 1 неделя","Среда | 1 неделя","Четверг | 1 неделя","Пятница | 1 неделя","Суббота | 1 неделя","Понедельник | 2 неделя","Вторник | 2 неделя","Среда | 2 неделя","Четверг | 2 неделя","Пятница | 2 неделя","Суббота | 2 неделя"]var We = ['воскресенье','понедельник','вторник','среда','четверг','пятница','суббота']var Mm = ["","января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"];var TT = {'пр.':'<i class="icon-briefcase"></i><i>  Практическое занятие</i>',' пр.':'<i class="icon-briefcase"></i><i>  Практическое занятие</i>','.':'<i class="icon-briefcase"></i><i>  Практическое занятие</i>',' .':'<i class="icon-briefcase"></i><i>  Практическое занятие</i>','лек.':'<i class="icon-mic"></i><i>  Лекция</i>',' лек.':'<i class="icon-mic"></i><i>  Лекция</i>','лаб.':'<i class="icon-thermometer"></i><i>Лабораторная работа</i>',' лаб.':'<i class="icon-thermometer"></i><i>Лабораторная работа</i>','сем.':'<i class="icon-chat"></i><i>Семинары</i>','кон.':'<i>Консультация</i>'};function Week(){	//var sep = new Date(2015,2,2);	//var now = $.parseJSON(document.getElementById('clock').innerHTML);	var now = new Date();	//console.log(now)	var de = now.currentWeek ;	    return de;// номер недели текущей}function Reiting(a){	var a;	var b="1-ая (";	if(a%2==0){b='2-ая ('};	if(a==8){		return  b+ a + ') рейтинговая';	}	else{		return  b+ a+ ')' ;	}}		      function timer(){//доделать				var now = new Date(document.getElementById('clock').innerHTML);		if(now.getDay()){var d = (now.getHours())*60 + now.getMinutes();}		else{			d  = 1300;		}        var a = [510,615,720,840,945,1050,1155];// начало пары        var b =[0 ,600,705,810,930,1035,1140,1245];// конец пары        var e1;        var e2        var i;				if(d<510){			e1 =a[0] - d;			e1 = "До начала 1-ой пары "+ hh((e1/60)|0) +' '+ mm(e1%60);			e2="";		}		else{			for( i = 0;i < 7 ; i++ ){				if( d < a[i]){					e1 = a[i] - d;					e2 = b[i] - d;					if(e2<1){e2 = "Сейчас перемена.</br>";}					else{e2 = "Конец " + i +"-й пары через " + hh((e2/60)|0) +" "+mm(e2%60)+"</br>";}					e1 = "До начала "+ (i+1) +"-й пары " + hh((e1/60)|0) +" "+mm(e1%60);									break;				}			}		};		if(d>1154){			e2  = b[i] - d;			e1= "";			e2= "Конец 7-й пары через "+  hh((e2/60)|0) +" "+mm(e2%60);		};		if(d>1244){			e1= "Пары закончились";			e2= "";		};		if((now.getDay()=='0') || (now.getDay()=='6' && d>1244)){			e1 = "Выходные <i class='icon-emo-wink2'></i>";			e2 = "";		}		return (e2 + e1);              }		function hh(h){			var h;			var cov= [5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,25,26,27,28,29,30,35];			var ca = [2,3,4,22,23,24,32,33];			var c = [1,21,31];			if(h==0){h=" "};			if($.inArray(h, cov) != -1){				h = h + " часов";			};			if($.inArray(h, ca) != -1){				h = h + " часа";			};			if($.inArray(h, c) != -1){				h = h + " час";			};			return h;		}		function mm(h){			var h;			var cov= [5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,25,26,27,28,29,30,35,36,37,38,39,40,45,46,47,48,49,50,55,56,57,58,59];			var ca = [1,21,31,41,51];			var c = [2,3,4,22,23,24,32,33,34,42,43,44,52,53,54];			if(h == 0){h=" "};			if($.inArray(h, cov) != -1){				h = h + " минут";			};			if($.inArray(h, ca) != -1){				h = h + " минута";			};			if($.inArray(h, c) != -1){				h = h + " минуты";			};			return h;		}function startTime(){// часы с секундами			document.getElementById('clock').innerHTML = data  ;			now = new Date();			var mm=now.currentMonth;			var dd=now.currentDate;			var yy=now.currentYear;			var h=now.currentHours;			var m=now.currentMinutes;									//privet Vadim!Pojeley svoi glaza =)			var tc = '<div id="time_div" style="font-size:16px;font-weight:700;font-family:Verdana;background-color:transparent;">'+ h + '<b id="blink">:</b>' + m + '</div>'			 var cp ="";			if ( now.currentDay == '6' || now.currentDay == '0') {				//document.getElementById('hh').innerHTML=tc+ We[now.currentDay]+', '+ dd+" "+ Mm[mm] + ' '+ yy +'<br>'  + 'следующая ' + nech(Week()+1 )  +' учебная неделя' + cp/* +timer() */+'</div>';			}			else{				//document.getElementById('hh').innerHTML=tc+ We[now.currentDay]+', '+ dd+" "+ Mm[mm] + ' '+ yy +'<br>'    + nech(Week())  +' учебная неделя'+ cp/* +timer() */+'</div>';			}function fn(a){	var a;	$.ajax({		type: "POST",		url: 'nprep.php?action=go',		data: 'tt='+a ,		success: function(data){			document.getElementById('cap').innerHTML =data ;					}	});}function cook(id){	var id;	var z = prov(id);	var a;	var b = [];	var mas = nname(id);	if(mas[1]==1){		lostpost(mas[0]);		lostget();		document.getElementById('cap').innerHTML = id ;		var nn = "<h3>Расписание занятий";		if(z == 0){nn +=" учебной группы <b>" + id };		if(z == 2){nn +=" в аудитории <b>" + id };		if(z == 1){fn(id)};						$.ajax({          type: 'POST',          url: 'resp.php?action=go',          data: 'name='+id+'&tp='+ z,          success: function(data){			a = JSON.parse(data);						clear();			var time = ["08:30 10:00", "10:15 11:45", "12:00 13:30","14:00 15:30","15:45 17:15","17:30 19:00","19:15 20:45"];			var z;			if(a[0][8]!='0'){				for(var i=0;i< (Array.prototype.slice.call( a, 0 ).length);i++){				'<abbr title="Расписание занятий' +  +' " rel="tooltip">'					a[i][8] = '<i class="icon-users-1"></i>  <a onclick=\"cook(\''+ a[i][8] +'\')\" href="#"><abbr title="Расписание занятий группы ' +  a[i][8] +' " rel="tooltip"><strong>'+ a[i][8] +'</strong></abbr></a>';				};			for(var i=0;i< (Array.prototype.slice.call( a, 0 ).length);i++){			for(var j=i+1;j< (Array.prototype.slice.call( a, 0 ).length);j++){				if(a[j]&&a[i]){					if(a[j][3]==a[i][3] && a[j][6]==a[i][6] && a[j][7]==a[i][7] && a[j][5]==a[i][5]){						a[i][8] += '</br>'+a[j][8];							delete a[j];					}				}			}			}			}			if(!device.mobile()&&!device.tablet()){						for(i=0;i< (Array.prototype.slice.call( a, 0 ).length);i++){						//console.log(a[i]);				if(a[i]){					document.getElementById('d'+a[i][7]).innerHTML = '<td colspan="4" >'+Wk[a[i][7]]+'</td>';// сделать блок видимым основной					document.getElementById('d'+a[i][7] + 'n'+a[i][6]).innerHTML =					'<td style="text-align:center"><i>' + a[i][6] +'  пара </i></br>' +					time[a[i][6]-1] +'</td>' +					'<td >' + TT[a[i][1]] +'<br><b>' + a[i][4] + '</b><br><i class="icon-user-1" ></i>  <a onclick=\"cook(\''+ a[i][3] +'\')\" href="#"><abbr title="Расписание занятий преподавателя: ' +  a[i][2] +' '+ a[i][10] +' " rel="tooltip"><i> '+ a[i][2] +' '+ a[i][10] +'</i></abbr></a>' +					'</td><td><i class="icon-location" ></i><a onclick=\"cook(\''+ a[i][5] +'\')\" href="#"><abbr title="Расписание занятий в аудитории ' +  a[i][5] +' " rel="tooltip"><strong>'+ a[i][5] +'</strong></abbr></a>'+					'</td><td>'  + a[i][8] +'</td>'// +								}			}			}			else{			for(i=0;i< (Array.prototype.slice.call( a, 0 ).length);i++){				if(a[i]){					document.getElementById('d'+a[i][7]).innerHTML = '<td colspan="3" >'+Wk[a[i][7]]+'</td>';// сделать блок видимым основной					document.getElementById('d'+a[i][7] + 'n'+a[i][6]).innerHTML =					'<td style="text-align:center"><i>' + a[i][6] +'  пара </i></br>' +					time[a[i][6]-1] +'</td>' +					'<td >' + TT[a[i][1]] +'<br><b>' + a[i][4] + '</b></br><hr><i class="icon-user-1" ></i>  <a onclick=\"cook(\''+ a[i][3] +'\')\" href="#"><abbr title="Расписание занятий преподавателя: ' +  a[i][2] +' '+ a[i][10] +' " rel="tooltip"><i> '+ a[i][2] +' '+ a[i][10] +'</i></abbr></a>' +					'<br><hr><i class="icon-location" ></i><a onclick=\"cook(\''+ a[i][5] +'\')\" href="#"><abbr title="Расписание занятий в аудитории ' +  a[i][5] +' " rel="tooltip"><strong>'+ a[i][5] +'</strong></abbr></a>'+					'<br><hr>'  + a[i][8] +'</td>'// +								}			}			};						today();			tte('tt', id + '("Расписание АГТУ Online" www.2astu.org)',id+'.xls');		  }		         });		return a;		}		else{		clear();			document.getElementById("d0n1").innerHTML =  mas.join(" ");					}	}	function today(){var df;	//var now = $.parseJSON(document.getElementById('clock').innerHTML);	var nn = now.currentDay*1;	var ww = now.currentWeek;	var d = (now.currentHours)*60 + now.currentMinutes*1;	var a = [ 510,615,720,840,945,1050,1155 ]; 	var cosp = '3';		var tod='Сегодня | '		if(ww%2==0){df = nn + 5}		else{df = nn - 1};		if(!device.mobile()&&!device.tablet()){cosp = '4'};	if( (nn == 0)&& (ww%2==0) ){df = 0 ;tod='Завтра | '};	if( (nn == 0)&& (ww%2==1) ){df = 6 ;tod='Завтра | '};		document.getElementById('d' + df).style.backgroundColor ='#333399';		document.getElementById('d' + df).style.color ='#fff';		document.getElementById('d' + df).innerHTML = '<td colspan="'+ cosp +'" >'+ tod + Wk[df]+'</td>'		document.getElementById('today').href = '#d' + df;		if(nn!=0){		for( var i = 0 ;i < 8; i++){			if(a[i]<d && (a[i]+90)>d){				document.getElementById('d' + df + 'n' +  (i+1) ).style.backgroundColor ='#F6EEA7';				break			};		}			}	document.getElementById('time').style.display = "block" //'#d' + df;window.location.href = "#d"+df;	}function nech(a){var a;if(a%2==0 ){	return 'Вторая';}else{return 'Первая'};}var tte = (function () {        var uri = 'data:application/vnd.ms-excel;base64,'        , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'        , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }        , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }        return function (table, name, filename) {				//(\<tr id=\"d.n.\"\><\/tr\>)		var str = document.getElementsByTagName('table')[0].innerHTML;		str = str.replace(/(\<tr id=\"d).*?(n.\"\><\/tr\>)/g," ");		str = str.replace(/(\<tr id=\"d).*?(\" style=).*(\"\>\<\/tr\>)/g," ");		str = str.replace(/rgb\(36, 98, 138\)/g,"#6facd5");		str = str.replace(/rgb\(172, 210, 234\)/g,"#fff");            if (!table.nodeType) table = document.getElementsByTagName('table')[0];            var ctx = { worksheet: name || 'Worksheet', table: str }           document.getElementById('time').getElementsByTagName('a')[2].href = uri + base64(format(template, ctx));            document.getElementById('time').getElementsByTagName('a')[2].download = filename;        }    })()			function prov(b){		var b;		var re = /[0-9][0-9][0-9]|гл|[0-9]\.[0-9]|гл\.[0-9]|(.\/[А-Я])|(С\.сп\.ком_1)|С\.стадион/i;		if(re.test(b)){			b='2';		}		else{			if(b.indexOf("\/")==-1){b ='1'}else{b='0'};		}		return b; 	}		function nname(str){		var str;		var j=0;		var mas=[];		var tt;		mas[0]='<h4 align="center" WIDTH=70%>Поиск по запросу \"'+ str +'\" :</h4>';		str.replace("-","_");		for(var i=0;i< (Array.prototype.slice.call( data, 0 ).length);i++){			var t = data[i].label;			if( t.toLowerCase().indexOf(str.toLowerCase())>-1 ){				j++;				tt = data[i].label;				mas.push('<p align="center" WIDTH=70% ><a class="ui-link-inherit" onclick=\"cook(\'' + data[i].label +'\')\" href="#">'+data[i].label+'</a></p>')};			}		if(j > 1){			return mas;		}		else{			if( j == 1){				mas[0] = tt;				mas[1] = 1;			}			else{  				mas[0] = '<h4 align="center" WIDTH=70%>Поиск по запросу \"'+ str+'\" не дал результатов.</br> Пожалуйста, проверьте правильность введённых данных.<h4>'			}			return mas;		}			}	  			function clear(){		for(var j=0;j<12;j++){						document.getElementById('d' + j).innerHTML = "";			for(var i=1;i<8;i++){				document.getElementById('d'+j+'n'+i).innerHTML = "";				document.getElementById('d' + j + 'n' +  i ).style.backgroundColor ='';			}			}	}	function getCookie(name) {  var matches = document.cookie.match(new RegExp(    "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"  ));  return matches ? decodeURIComponent(matches[1]) : undefined;}function lostget(){if(typeof getCookie('lost') != "undefined"){var lost = getCookie('lost').split(',');for(var i = 0; i <lost.length;i++){	if(lost[i]!='0'){		document.getElementById('li'+i).style.display = "";				(document.getElementById('li'+i).getElementsByTagName('a')[0]).onclick = function(){cook(lost[this.id]);  /* cook(this.parentNode.parentNode.parentNode.id)  */ }		document.getElementById(i).innerHTML = lost[i];	}} }}function startget(){	if(typeof getCookie('start')!= "undefined"){		cook(getCookie('start'));		deleteCookie('start');	}}function setCookie(cname, cvalue, exdays) {    var d = new Date();    d.setTime(d.getTime() + (exdays*24*60*60*1000));    var expires = "expires="+d.toUTCString();	cvalue = encodeURIComponent(cvalue);    document.cookie = cname + "=" + cvalue + "; " + expires;}function clearCookie(val){	var val;	var lost=[];	lost = getCookie('lost').split(',');	lost[val]="0";	deleteCookie('lost');	setCookie('lost', lost, 365);	document.getElementById('li'+val).style.display='none';}function CallPage(n){	var n	setCookie('start',n,2);	document.location.href = "";}function lostpost(post){	var post;	var lost=[];	if(typeof getCookie('lost')== "undefined"){setCookie('lost', [0,0,0], 365)};	lost = getCookie('lost').split(',');	if(post != lost[0] && post != lost[1] && post != lost[2]){		lost[2] = lost[1];		lost[1] = lost[0];		lost[0] = post;		deleteCookie('lost');		setCookie('lost', lost, 365)	}}function deleteCookie(name) {  setCookie(name, "", -1)}